function D3jsYabane(d,a,b){this.d3=d;this.selector=a;var c={scale:{x:null,y:null,start:null,end:null,dates:[]},lane:{h:33,w:null,tick:88,padding:5},data:[]};this.config=this.merge(c,b)}D3jsYabane.prototype.merge=function(a,b){return Object.assign({},a,b)};D3jsYabane.prototype.point=function(a,b){return a+", "+b+" "};D3jsYabane.prototype.makeScaleData=function(f){var c={start:null,end:null,list:[]};for(var e in f){var g=f[e];var h=g.start;var a=g.end;if(c.start==null||c.start>g.start){c.start=h}if(c.end==null||c.end<a){c.end=a}}var b=new Date(c.start);do{c.list.push(new Date(b));b.setDate(b.getDate()+1)}while(b<c.end);return c};D3jsYabane.prototype.buildAxis_x=function(d,a,c,b){return this.d3.scaleTime().domain([d,a]).range([c,b])};D3jsYabane.prototype.yabane_h=function(){return this.config.lane.h-(this.config.lane.padding*2)};D3jsYabane.prototype.yabane_w=function(a){return this.config.scale.x(a.end)-this.config.scale.x(a.start)};D3jsYabane.prototype.yabane_x=function(a){return this.config.scale.x(a.start)};D3jsYabane.prototype.yabane_y=function(b){var a=this.config.lane;return(a.h*b)+a.h+a.padding};D3jsYabane.prototype.lane_h=function(a){return this.config.lane.h*a.length};D3jsYabane.prototype.lane_w=function(a){return this.config.lane.tick*a.length};D3jsYabane.prototype.svg_h=function(b){var a=this.config.lane.h;return this.lane_h(b)+a};D3jsYabane.prototype.svg_w=function(a){return this.config.lane.tick*a.length};D3jsYabane.prototype.initConfig=function(b){this.config.data=b;var a=this.makeScaleData(b);this.config.scale.start=a.start;this.config.scale.end=a.end;this.config.scale.dates=a.list};D3jsYabane.prototype.draw=function(a){this.initConfig(a);this.drawCore(this.merge({},this.config))};D3jsYabane.prototype.drawCore=function(a){var b=this.config.scale;this.config.scale.x=this.buildAxis_x(a.scale.start,a.scale.end,0,this.svg_w(a.scale.dates));this.d3.select("svg.chart-yabane").attr("width",this.svg_w(a.scale.dates)).attr("height",this.svg_h(a.data));this.drawLane(a);this.drawLaneHeader(a);this.drawLaneDateSpliter(a);this.drawYabane(a)};D3jsYabane.prototype.drawLaneHeader=function(b){var d=b.scale;var a=b.lane;var c=this;this.d3.select("svg.chart-yabane").selectAll("rect.lane-line-vertical").data(b.scale.dates).enter().append("text").attr("class","lane-header-text").attr("x",function(e){return d.x(e)+5}).attr("y",function(e){return 22}).attr("font-family","sans-serif").attr("font-size",function(e){return a.h-(a.padding*2)-(3*2)-5}).attr("fill","black").text(function(g){var f=g.getDay();var e=["日","月","火","水","木","金","土"][f];return(g.getMonth()+1)+"/"+g.getDate()+"("+e+")"})};D3jsYabane.prototype.drawLaneDateSpliter=function(b){var d=b.scale;var a=b.lane;var c=this;this.d3.select("svg.chart-yabane").selectAll("rect.lane-line-vertical").data(b.scale.dates).enter().append("line").attr("class","lane-line-vertical").attr("stroke-width",1).attr("stroke","#000").attr("x1",function(f,e){return d.x(f)}).attr("x2",function(f,e){return d.x(f)}).attr("y1",a.h).attr("y2",1000)};D3jsYabane.prototype.drawLane=function(a){var b=this;this.d3.select("svg.chart-yabane").selectAll("rect.lane").data(a.data).enter().append("rect").attr("class","lane").attr("width",b.lane_w(a.scale.dates)).attr("height",a.lane.h).attr("y",function(e,c){return(a.lane.h*c)+a.lane.h}).attr("stroke","#99ab4e").attr("fill","#fff").attr("stroke-width","2")};D3jsYabane.prototype.drawYabane=function(b){var a=b.lane;var e=b.scale;var c=this;var d=this.d3.select("svg.chart-yabane").selectAll("polygon").data(b.data).enter();d.append("polygon").attr("points",function(l,j){var f=new Date(l.start);var g=new Date(l.end);var k=c.yabane_h();var p=c.yabane_w(l);var o=c.yabane_x(l);var n=c.yabane_y(j);var m=10;return c.point(o,n)+c.point((o+p-m),n)+c.point((o+p),(n+(k/2)))+c.point((o+p-m),(n+k))+c.point(o,(n+k))}).attr("stroke","#006e54").attr("fill","#38b48b").attr("stroke-width",1);d.append("text").attr("x",function(f){return c.yabane_x(f)+11}).attr("y",function(g,f){return c.yabane_y(f)+20-3}).text(function(f){return"["+f.code+"] "+f.name}).attr("font-family","sans-serif").attr("font-size",function(f){return a.h-(a.padding*2)-(3*2)}).attr("fill","black")};
