function D3jsYabane(t,e,a){this.d3=t,this.selector=e;var n={scale:{x:null,y:null,start:null,end:null,dates:[]},lane:{h:33,w:null,tick:88,padding:5},data:[]};n.lane=this.merge(n.lane,a.lane),this.config=this.merge({},n)}D3jsYabane.prototype.merge=function(t,e){return Object.assign({},t,e)},D3jsYabane.prototype.point=function(t,e){return t+", "+e+" "},D3jsYabane.prototype.makeScaleData=function(t,e){var a={start:null,end:null,list:[]};for(var n in e){var r=e[n],s=r.start,i=r.end;(null==a.start||a.start>r.start)&&(a.start=s),(null==a.end||a.end<i)&&(a.end=i)}a.start=new Date(a.start),a.end=new Date(a.end),"w"==t.lane.cycle?(a.start.setDate(a.start.getDate()-28),a.end.setDate(a.end.getDate()+70)):(a.start.setDate(a.start.getDate()-2),a.start.setDate(a.start.getDate()+5));var l=1;if("w"==t.lane.cycle){l=7;var o=a.start.getDay();0==o?a.start.setDate(a.start.getDate()-6):a.start.setDate(a.start.getDate()-(o-1)),o=a.end.getDay(),0==o?a.end.setDate(a.end.getDate()+6):a.end.setDate(a.end.getDate()+(o-1))}var c=new Date(a.start);do a.list.push(new Date(c)),c.setDate(c.getDate()+l);while(c<a.end);return a},D3jsYabane.prototype.buildAxis_x=function(t,e,a,n){return this.d3.scaleTime().domain([t,e]).range([a,n])},D3jsYabane.prototype.yabane_h=function(){return this.config.lane.h-2*this.config.lane.padding},D3jsYabane.prototype.yabane_w=function(t){return this.config.scale.x(t.end)-this.config.scale.x(t.start)},D3jsYabane.prototype.yabane_x=function(t){return this.config.scale.x(t.start)},D3jsYabane.prototype.yabane_y=function(t){var e=this.config.lane;return e.h*t+e.h+e.padding},D3jsYabane.prototype.lane_h=function(t){return this.config.lane.h*t.length},D3jsYabane.prototype.lane_w=function(t){return this.config.lane.tick*t.length},D3jsYabane.prototype.svg_h=function(t){var e=this.config.lane.h;return this.lane_h(t)+e},D3jsYabane.prototype.svg_w=function(t){return this.config.lane.tick*t.length},D3jsYabane.prototype.initConfig=function(t){this.config.data=t;var e=this.makeScaleData(this.config,t);this.config.scale.start=e.start,this.config.scale.end=e.end,this.config.scale.dates=e.list},D3jsYabane.prototype.draw=function(t){this.initConfig(t),this.drawCore(this.merge({},this.config))},D3jsYabane.prototype.drawCore=function(t){this.config.scale;this.config.scale.x=this.buildAxis_x(t.scale.start,t.scale.end,0,this.svg_w(t.scale.dates)),this.d3.select(this.selector).attr("width",this.svg_w(t.scale.dates)).attr("height",this.svg_h(t.data)+5),this.drawLane(t),this.drawLaneHeader(t),this.drawLaneDateSpliter(t),this.drawYabane(t),this.drawLaneToday(t)},D3jsYabane.prototype.drawLaneHeader=function(t){var e=t.scale,a=t.lane;this.d3.select(this.selector).selectAll("rect.lane-line-vertical").data(t.scale.dates).enter().append("text").attr("class","lane-header-text").attr("x",function(t){return e.x(t)+5}).attr("y",function(t){return 22}).attr("font-family","sans-serif").attr("font-size",function(t){return a.h-2*a.padding-6-5}).attr("fill","black").text(function(t){var e=t.getDay(),a=["日","月","火","水","木","金","土"][e];return t.getMonth()+1+"/"+t.getDate()+"("+a+")"})},D3jsYabane.prototype.drawLaneDateSpliter=function(t){var e=t.scale,a=t.lane,n=this;this.d3.select(this.selector).selectAll("rect.lane-line-vertical").data(t.scale.dates).enter().append("line").attr("class","lane-line-vertical").attr("stroke-width",1).attr("stroke","#99ab4e").attr("stroke-dasharray","3 3").attr("x1",function(t,a){return e.x(t)}).attr("x2",function(t,a){return e.x(t)}).attr("y1",a.h).attr("y2",function(){return n.lane_h(t.data)+a.h})},D3jsYabane.prototype.drawLaneToday=function(t){var e=this,a=new Date,n=t.scale,r=t.lane,e=this;this.d3.select(this.selector).selectAll("rect.lane-line-vertical").data(t.scale.dates).enter().append("line").attr("class","lane-line-vertical").attr("stroke-width",1).attr("stroke","#e198b4").attr("x1",function(t,e){return n.x(a)}).attr("x2",function(t,e){return n.x(a)}).attr("y1",r.h-5).attr("y2",function(){return e.lane_h(t.data)+r.h+5})},D3jsYabane.prototype.drawLane=function(t){var e=this;this.d3.select(this.selector).selectAll("rect.lane").data(t.data).enter().append("rect").attr("class","lane").attr("width",e.lane_w(t.scale.dates)).attr("height",t.lane.h).attr("y",function(e,a){return t.lane.h*a+t.lane.h}).attr("stroke","#99ab4e").attr("fill","#fff").attr("stroke-width","1")},D3jsYabane.prototype.drawYabane=function(t){var e=t.lane,a=(t.scale,this),n=this.d3.select(this.selector).selectAll("polygon").data(t.data).enter();n.append("polygon").attr("points",function(t,e){var n=(new Date(t.start),new Date(t.end),a.yabane_h()),r=a.yabane_w(t),s=a.yabane_x(t),i=a.yabane_y(e),l=10;return a.point(s,i)+a.point(s+r-l,i)+a.point(s+r,i+n/2)+a.point(s+r-l,i+n)+a.point(s,i+n)}).attr("stroke","#99ab4e").attr("fill","#aacf53").attr("stroke-width",1).attr("fill-opacity",.88).append("title").text(function(t){return"code: "+t.code+"\nname: "+t.name+"\nstart: "+t.start+"\nend  : "+t.end}),n.append("text").attr("x",function(t){return a.yabane_x(t)+11}).attr("y",function(t,e){return a.yabane_y(e)+20-5}).text(function(t){return"["+t.code+"] "+t.name}).attr("font-family","sans-serif").attr("font-size",function(t){return e.h-3*e.padding-6}).attr("fill","black")};
